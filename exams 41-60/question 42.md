## Question #42
Availability Zones. 
The EC2 instances do not communicate with each other. 
However, the EC2 instances download images from Amazon S3 and upload images to Amazon S3 through a single NAT gateway. 
The company is concerned about data transfer charges.

What is the MOST cost-effective way for the company to avoid Regional data transfer charges?

A. Launch the NAT gateway in each Availability Zone.

B. Replace the NAT gateway with a NAT instance.

C. Deploy a gateway VPC endpoint for Amazon S3.

D. Provision an EC2 Dedicated Host to run the EC2 instances.

## Question #42 λ¶„μ„

### β… μ”κµ¬μ‚¬ν•­
- EC2 μΈμ¤ν„΄μ¤λ“¤μ΄ **S3μ—μ„ μ΄λ―Έμ§€ λ‹¤μ΄λ΅λ“/μ—…λ΅λ“**
- ν„μ¬ **λ‹¨μΌ NAT Gateway** μ‚¬μ©
- **λ¦¬μ „ λ‚΄ λ°μ΄ν„° μ „μ†΅ λΉ„μ©** μ°λ ¤
- **κ°€μ¥ λΉ„μ© ν¨μ¨μ μΈ** ν•΄κ²°μ±…

### β… ν„μ¬ μ•„ν‚¤ν…μ² λ¬Έμ μ 
```yaml
ν”„λΌμ΄λΉ— μ„λΈλ„· EC2 β†’ NAT Gateway β†’ μΈν„°λ„· β†’ S3

λ°μ΄ν„° μ „μ†΅ κ²½λ΅:
  1. EC2 β†’ NAT Gateway (AZ κ°„ μ „μ†΅ μ‹ κ³ΌκΈ)
  2. NAT Gateway β†’ μΈν„°λ„· (NAT μ²λ¦¬ λΉ„μ©)
  3. μΈν„°λ„· β†’ S3 (μ™Έλ¶€ κ²½μ λ΅ λΉ„ν¨μ¨)

λΉ„μ© λ°μƒ μ”μ†:
  β NAT Gateway μ‹κ°„λ‹Ή λΉ„μ©
  β NAT Gateway λ°μ΄ν„° μ²λ¦¬ λΉ„μ© ($0.045/GB)
  β AZ κ°„ λ°μ΄ν„° μ „μ†΅ λΉ„μ© ($0.01/GB)
  β μΈν„°λ„· κ²½μ λ΅ μΈν• λΉ„ν¨μ¨μ„±
```

### β… μ„ νƒμ§€ λ¶„μ„

**A. κ° AZμ— NAT Gateway λ°°μΉ**
- **AZ κ°„ μ „μ†΅ μ κ±°**: λ™μΌ AZ λ‚΄ ν†µμ‹  β…
- **NAT λΉ„μ© μ¦κ°€**: μ—¬λ¬ NAT Gateway μ΄μ 
- **μ—¬μ „ν μΈν„°λ„· κ²½μ **: κ·Όλ³Έμ  ν•΄κ²° μ•λ¨ 
- λ¶€λ¶„μ  κ°μ„ μ΄μ§€λ§ λΉ„μ© ν¨μ¨μ μ΄μ§€ μ•μ

**B. NAT Instanceλ΅ κµμ²΄**
- **λ” λ‚®μ€ λΉ„μ©**: μΈμ¤ν„΄μ¤ λΉ„μ©λ§ 
- **κ΄€λ¦¬ λ³µμ΅μ„±**: κ³ κ°€μ©μ„±, μ„±λ¥ νλ‹ ν•„μ” 
- **μ—¬μ „ν μΈν„°λ„· κ²½μ **: κ·Όλ³Έμ  ν•΄κ²° μ•λ¨ 
- **λ‹¨μΌ μ¥μ• μ **: μΈμ¤ν„΄μ¤ μ¥μ•  μ‹ μ „μ²΄ μν–¥

**C. S3 Gateway VPC Endpoint** β­
- **ν”„λΌμ΄λΉ— μ—°κ²°**: μΈν„°λ„· κ²½μ  λ¶ν•„μ” β…
- **λ°μ΄ν„° μ „μ†΅ λ¬΄λ£**: VPC λ‚΄λ¶€ νΈλν”½ β…
- **NAT Gateway λ¶ν•„μ”**: μ™„μ „ μ κ±° κ°€λ¥ β…
- **κ΄€λ¦¬ κ°„μ†ν™”**: μ„λ²„λ¦¬μ¤, μ„¤μ •λ§ ν•„μ” β…
- **μµλ€ λΉ„μ© μ μ•½**: λ¨λ“  μ „μ†΅ λΉ„μ© μ κ±° β…

**D. EC2 Dedicated Host**
- **ν•λ“μ›¨μ–΄ κ²©λ¦¬**: S3 μ ‘κ·Όκ³Ό λ¬΄κ΄€ 
- **λ†’μ€ λΉ„μ©**: μ „μ© ν•λ“μ›¨μ–΄ λΉ„μ© 
- **λ°μ΄ν„° μ „μ†΅ κ°μ„  μ—†μ**: λ¬Έμ  ν•΄κ²° μ•λ¨ 
- μ™„μ „ λ‹¤λ¥Έ μμ—­μ μ†”λ£¨μ…

### π“‹ Gateway VPC Endpoint μ΄ν•΄

#### **Gateway Endpoint μ‘λ™ μ›λ¦¬**
```yaml
ν”„λΌμ΄λΉ— μ—°κ²°:
  EC2 (ν”„λΌμ΄λΉ— μ„λΈλ„·) β†’ VPC Endpoint β†’ S3
  
νΉμ§•:
  - μΈν„°λ„·μ„ κ²½μ ν•μ§€ μ•μ
  - AWS λ°±λ³Έ λ„¤νΈμ›ν¬ μ‚¬μ©
  - VPC λ‚΄λ¶€ νΈλν”½μΌλ΅ μ²λ¦¬
  - NAT Gateway/Instance λ¶ν•„μ”
```

#### **κΈ°μ΅΄ vs κ°μ„ λ μ•„ν‚¤ν…μ²**
```yaml
κΈ°μ΅΄ (NAT Gateway):
  EC2 β†’ NAT GW β†’ μΈν„°λ„· β†’ S3
  λΉ„μ©: NAT + λ°μ΄ν„° μ²λ¦¬ + AZ κ°„ μ „μ†΅

κ°μ„  (Gateway Endpoint):
  EC2 β†’ Gateway Endpoint β†’ S3
  λΉ„μ©: $0 (μ™„μ „ λ¬΄λ£) β…
```


### π”„ λ‹¤λ¥Έ μµμ…λ“¤μ ν•κ³„

#### **κ° AZ NAT Gateway (Aλ²)**
```yaml
3κ° AZ λ°°μΉ μ‹:
  μ‹κ°„λ‹Ή λΉ„μ©: $0.045 Γ— 3 = $0.135/μ‹κ°„
  μ›” λΉ„μ©: $97.2/μ›” (3λ°° μ¦κ°€)
  
μ¥μ :
  β… AZ κ°„ μ „μ†΅ λΉ„μ© μ κ±° ($10/μ›” μ μ•½)
  
λ‹¨μ :
  β NAT μ‹κ°„λ‹Ή λΉ„μ© 3λ°° μ¦κ°€ (+$65/μ›”)
  β λ°μ΄ν„° μ²λ¦¬ λΉ„μ© λ™μΌ ($45/μ›”)
  β μ—¬μ „ν μΈν„°λ„· κ²½μ 
  
κ²°κ³Ό: μ¤νλ ¤ λΉ„μ© μ¦κ°€ β
```

#### **NAT Instance (Bλ²)**
```yaml
t3.micro κΈ°μ¤€:
  μ›” λΉ„μ©: $8.5/μ›” (NAT Gateway λ€λΉ„ μ €λ ΄)
  
μ¥μ :
  β… λ‚®μ€ μΈμ¤ν„΄μ¤ λΉ„μ©
  
λ‹¨μ :
  β μ„±λ¥ μ ν• (μΈμ¤ν„΄μ¤ μ¤ν™μ— μμ΅΄)
  β κ³ κ°€μ©μ„± κµ¬ν„ λ³µμ΅
  β κ΄€λ¦¬ μ¤λ²„ν—¤λ“ (ν¨μΉ, λ¨λ‹ν„°λ§)
  β μ—¬μ „ν AZ κ°„ μ „μ†΅ λΉ„μ©
  β λ‹¨μΌ μ¥μ• μ 
  
μ μ•½μ•΅: μ ν•μ μ΄λ©° μ΄μ λ³µμ΅μ„± μ¦κ°€
```

#### **Dedicated Host (Dλ²)**
```yaml
Dedicated Host λΉ„μ©:
  m5.large host: $2,000+/μ›”
  
λ¬Έμ μ :
  β λ°μ΄ν„° μ „μ†΅ κ²½λ΅ λ³€ν™” μ—†μ
  β S3 μ ‘κ·Ό λ°©μ‹ λ™μΌ
  β μ—„μ²­λ‚ λΉ„μ© μ¦κ°€
  β λ¬Έμ μ™€ μ™„μ „ λ¬΄κ΄€ν• μ†”λ£¨μ…
```


### **μ„¤μ • κ³Όμ •**
```yaml
1. VPC Endpoint μƒμ„±:
   μ„λΉ„μ¤: com.amazonaws.region.s3
   νƒ€μ…: Gateway
   VPC: ν•΄λ‹Ή VPC μ„ νƒ
   
2. λΌμ°ν… ν…μ΄λΈ” μ—…λ°μ΄νΈ:
   μλ™μΌλ΅ S3 νΈλν”½μ΄ Endpointλ΅ λΌμ°ν…
   
3. NAT Gateway μ κ±°:
   S3 μ „μ© νΈλν”½μ΄λ―€λ΅ NAT λ¶ν•„μ”
   
μ„¤μ • μ‹κ°„: 5λ¶„
```

### **λΌμ°ν… ν…μ΄λΈ” λ³€ν™”**
```yaml
κΈ°μ΅΄ λΌμ°ν…:
  0.0.0.0/0 β†’ NAT Gateway
  (λ¨λ“  νΈλν”½μ΄ NAT κ²½μ )

Gateway Endpoint ν›„:
  S3 prefix list β†’ Gateway Endpoint
  0.0.0.0/0 β†’ NAT Gateway (λ‹¤λ¥Έ μΈν„°λ„· νΈλν”½μ©)
  
S3 νΈλν”½λ§ ν”„λΌμ΄λΉ— κ²½λ΅ μ‚¬μ© β…
```

### **μ„±λ¥ ν–¥μƒ**
```yaml
λ„¤νΈμ›ν¬ κ²½λ΅:
  κΈ°μ΅΄: EC2 β†’ NAT β†’ μΈν„°λ„· β†’ S3 (ν™‰ μ λ§μ)
  κ°μ„ : EC2 β†’ Gateway Endpoint β†’ S3 (μ§μ ‘ μ—°κ²°)

μ§€μ—° μ‹κ°„:
  κΈ°μ΅΄: NAT μ²λ¦¬ + μΈν„°λ„· λΌμ°ν… μ§€μ—°
  κ°μ„ : AWS λ‚΄λ¶€ λ„¤νΈμ›ν¬λ΅ μµμ† μ§€μ—°

μ²λ¦¬λ‰:
  κΈ°μ΅΄: NAT Gateway λ€μ—­ν­ μ ν•
  κ°μ„ : VPC λ„¤νΈμ›ν¬ λ€μ—­ν­ ν™μ©
```
